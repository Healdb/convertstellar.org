

<div id="container">
<HTML>
<div id="header">
<HEAD>
<TITLE>HOMEWORK</TITLE>
<meta name="viewport" content="user-scalable=no, width=device-width" />
<link rel="stylesheet" type="text/css" href="index.css">
<script src="jquery.js"></script>
<script src="inobounce.js"></script>
<script type="text/javascript" src="fetchp.js"></script>
<link href="switchery.css" rel="stylesheet" />
<link rel="stylesheet" href="highlight.css">
    <link rel="stylesheet" href="framework7.min.css">
	<script>
function changeList(site, html){
	var i = 0;
	var x ="";
	if (html==" "){
	x= "No Change";
	}
	else{
	x="New Changes!"
	}
	while (i<5){
		var t = "r";
		var c = "c";
		c += i.toString();
		t += i.toString();
		i++;	
		if(document.getElementById(t).innerHTML == site){
			html += localStorage.getItem(c);
			document.getElementById(c).innerHTML = x;
			localStorage.setItem(c,html);
		}
		
	}
	}
</script>
<script>
function parseChange(site){
	var k ="x";
	console.log("p1");
	var request = $.getJSON('http://whateverorigin.org/get?url=' + encodeURIComponent(site) + '&callback=?');
		request.success(function(data) {
		console.log("p2");
		var str2 = data.contents;
		str2 = str2.replace(/(\r\n|\n|\r)/gm," ");
		try {
		
		var str= localStorage.getItem(site); 
		  str = str.replace(/(\r\n|\n|\r)/gm," ");
		  var res2 = str.split(" ");
		  var res = str2.split(" ");
		  //console.log(res);
		  //console.log(res2);
		  for(i=0;i<res.length;i++){
               for(t=0;t<res2.length;t++){
                    if(res[i] == res2[t]){
                         res[i] = "";
                    }
               }
          }
          var st = res.toString();
          k = st.replace(/,/g , "");
          k = k.replace(" ","");
			localStorage.setItem(site, str2);
			console.log("change" + k);
			var html = k;

			changeList(site, html)
			}	
		catch(err) {
			console.log("new entry " + err);
			localStorage.setItem(site, str2);
		}
		});
		request.error(function(jqXHR, textStatus, errorThrown) {
  if (textStatus == 'timeout')
        myApp.alert("An error occured when checking the website! Please try again!", "ERROR");

  if (textStatus == 'error')
    myApp.alert("An error occured when checking the website! Please try again!", "ERROR");
});
	}
</script>
<script>
function clearText(){
var i =0;
while (i<5){
var c ="c";
c+=i.toString();
localStorage.setItem(c,"");
i++;
}
}
</script>
	<script>
function checkSites(){
	var siteslist = localStorage.getObj("sites");
	var i = 0;
	var t = "r";
	while(i<siteslist.length){
		t = "r";
		var temp = siteslist[i];
		t += i.toString();
		console.log(temp);
		parseChange(temp);
		i++;
		document.getElementById(t).innerHTML = temp;
		
	}


	}
</script>
<script>
$(document).ready(function () {
$("#body2").hide();
$("#body3").hide();
$("#body1").show();
$("#body4").hide();
checkSites();
});
</script>
<script>
Storage.prototype.setObj = function(key, obj) {
    return this.setItem(key, JSON.stringify(obj))
}
Storage.prototype.getObj = function(key) {
    return JSON.parse(this.getItem(key))
}
</script>
</HEAD>
<!-- Views-->
    <div class="views">
      <!-- Your main view, should have "view-main" class-->
      <div class="view view-main">
        <!-- Top Navbar-->
        <div class="navbar">
          <!-- Navbar inner for Index page-->
          <div data-page="index" class="navbar-inner">
            <!-- We have home navbar without left link-->
			<div class="left">
              <!-- Right link contains only icon - additional "icon-only" class--><a class="link" id="title">Home</a> 
            </div>
			<div class="center">
              Homework
            </div>
            <div class="right">
              <!-- Right link contains only icon - additional "icon-only" class--><a id="showi" class="link" >Add</a>
            </div>
          </div>
        </div>
        <!-- Pages, because we need fixed-through navbar and toolbar, it has additional appropriate classes-->
        <div class="pages navbar-through toolbar-through">
          <!-- Index Page-->
          <div data-page="index" class="page">
<BODY >
<center>
<div class="page-content pull-to-refresh-content">
  <div class="pull-to-refresh-layer">
    <div class="preloader"></div>
    <div class="pull-to-refresh-arrow"></div>
  </div>
 <div class="body1" id="body1">
<p>Pull page down to refresh!</p>
 <div class="list-block">
  <ul>
    <li class="swipeout">
<div class="swipeout-content">
      <a href="#" id="a0" class="item-link item-content">
        <div class="item-inner">
          <div id="r0" class="item-title">Empty: Click the "add" button to add a new site.</div>
          <div id="c0" class="item-after">No Change</div>
        </div>
      </a>
    </div>
    <div class="swipeout-actions-right"><a href="#" class="action0">Clear</a></div>
</li>
    <li class="swipeout">
<div class="swipeout-content">
      <a href="#" id="a1" class="item-link item-content">
        <div class="item-inner">
          <div id="r1" class="item-title">Empty: Click the "add" button to add a new site. </div>
          <div id="c1" class="item-after">No Change</div>
        </div>
      </a>
    </div>
    <div class="swipeout-actions-right"><a href="#" class="action1">Clear</a></div>
</li>
	<li class="swipeout">
<div class="swipeout-content">
      <a href="#" id="a2" class="item-link item-content">
        <div class="item-inner">
          <div id="r2" class="item-title">Empty: Click the "add" button to add a new site. </div>
          <div id="c2" class="item-after">No Change</div>
        </div>
      </a>
    </div>
    <div class="swipeout-actions-right"><a href="#" class="action2">Clear</a></div>
</li>
	<li class="swipeout">
<div class="swipeout-content">
      <a href="#" id="a3" class="item-link item-content">
        <div class="item-inner">
          <div id="r3" class="item-title">Empty: Click the "add" button to add a new site. </div>
          <div id="c3" class="item-after">No Change</div>
        </div>
      </a>
    </div>
    <div class="swipeout-actions-right"><a href="#" class="action3">Clear</a></div>
</li>
	<li class="swipeout">
<div class="swipeout-content">
      <a href="#" id="a4" class="item-link item-content">
        <div class="item-inner">
          <div id="r4" class="item-title">Empty: Click the "add" button to add a new site. </div>
          <div id="c4" class="item-after">No Change</div>
        </div>
      </a>
	  	</div>
    <div class="swipeout-actions-right"><a href="#" class="action4">Clear</a></div>
</li>
    <li class="swipeout">
<div class="swipeout-content">
      <a href="#" id="a5" class="item-link item-content">
        <div class="item-inner">
          <div id="r5" class="item-title">Empty: Click the "add" button to add a new site.</div>
          <div id="c5" class="item-after">No Change</div>
        </div>
      </a>
    </div>
    <div class="swipeout-actions-right"><a href="#" class="action5">Clear</a></div>
</li>
  </ul>
</div>
</div>
<div id="body2">
<BR><BR><BR><BR><BR><BR><BR>
<form class="switchery-form">
                <p class="settings-heading">App Settings</p>
                
                <p class="setting-switch setting-switch-first">
                    <label for="setting1">Enable Dark Theme</label>
                    <!-- Switchery checkbox #1 -->
                    <input id = "theme" type="checkbox" class="js-switch js-check-change" name="setting1"/>
                </p>
            </form>
</div>
<div id="body3">
<BR><BR><BR><BR><BR><BR>
<p><font face="arial">This app helps you to keep track of your homework!</font></p>
<address><font face="arial">&copy; Copyright 2015 All Rights Reserved www.healdb.com</font></address>
</div>
<div id ="body4">
<BR><BR><BR><BR><BR><BR>
<p id = "change" ></p>
</div>
</div>
<script type="text/javascript" src="switchery.js"></script>
    <script type="text/javascript">
    console.log(localStorage.getItem("theme"));
		if(localStorage.getItem("theme")=="true"){
        var sheet = document.styleSheets[2];
        console.log(document.styleSheets[2]);
        sheet.addRule(".page", "background: #000000; background-color: rgb(0,0,0) !important;", 1);
        var sheet = document.styleSheets[0];
        document.getElementById("theme").checked = true;
        $('#theme').prop('checked', true);
        sheet.addRule("body", "color: white !important;", 1);
        }
        else{
        var sheet = document.styleSheets[2];
        sheet.removeRule(1);
        var sheet = document.styleSheets[0];
        sheet.removeRule(1);
         $('#theme').prop('checked', false);
        }

      // Default
      // if-else statement used only for fixing <IE9 issues
      if (Array.prototype.forEach) {
        var elems = Array.prototype.slice.call(document.querySelectorAll('.js-switch'));

        elems.forEach(function(html) {
          var switchery = new Switchery(html);
        });
      } else {
        var elems = document.querySelectorAll('.js-switch');

        for (var i = 0; i < elems.length; i++) {
          var switchery = new Switchery(elems[i]);
        }
      }

      // On change
      var changeCheckbox = document.querySelector('.js-check-change')
        , changeField = document.querySelector('.js-check-change-field');

      changeCheckbox.onchange = function() {
        console.log(changeCheckbox.checked);
        if(changeCheckbox.checked==true){
        var sheet = document.styleSheets[2];
        console.log(document.styleSheets[2]);
        sheet.addRule(".page", "background: #000000; background-color: rgb(0,0,0) !important;", 1);
        var sheet = document.styleSheets[0];
        sheet.addRule("body", "color: white !important;", 1);
        localStorage.setItem("theme", true);
        }
        if(changeCheckbox.checked==false){
        var sheet = document.styleSheets[2];
        console.log(document.styleSheets[2]);
        sheet.removeRule(1);
        var sheet = document.styleSheets[0];
        sheet.removeRule(1);
        localStorage.setItem("theme", false);
        }
      };
    </script>
    </center>
    <div class="toolbar">
          <div class="toolbar-inner"><a class="link" id = "shows">Settings</a><a  class="link" id = "showa" >About</a>
        </div>
      </div>
    <script type="text/javascript" src="framework7.min.js"></script>
    <script>
      var myApp = new Framework7();
      var $$ = Dom7;
	  $$('.action0').on('click', function () {
			var siteslist = localStorage.getObj("sites");
			var i = 0;
			siteslist.splice(i,1);
			localStorage.setObj("sites",siteslist)
			document.getElementById("r0").innerHTML = "Empty: Click the "add" button to add a new site."; 
			localStorage.setItem("c0","");
			document.getElementById("c0").innerHTML = "No Change";
			myApp.swipeoutClose($$('li.swipeout').eq(i));
		});
		$$('.action1').on('click', function () {
			var siteslist = localStorage.getObj("sites");
			var i = 1;
			siteslist.splice(i,1);
			localStorage.setObj("sites",siteslist)
			document.getElementById("r1").innerHTML = "Empty: Click the "add" button to add a new site."; 
			localStorage.setItem("c1","");
			document.getElementById("c1").innerHTML = "No Change";
			myApp.swipeoutClose($$('li.swipeout').eq(i));
		});  
		$$('.action2').on('click', function () {
			var siteslist = localStorage.getObj("sites");
			var i = 2;
			siteslist.splice(i,1);
			localStorage.setObj("sites",siteslist)
			document.getElementById("r2").innerHTML = "Empty: Click the "add" button to add a new site."; 
			localStorage.setItem("c2","");
			document.getElementById("c2").innerHTML = "No Change";
			myApp.swipeoutClose($$('li.swipeout').eq(i));
		});  
		$$('.action3').on('click', function () {
			var siteslist = localStorage.getObj("sites");
			var i = 3;
			siteslist.splice(i,1);
			localStorage.setObj("sites",siteslist)
			document.getElementById("r3").innerHTML = "Empty: Click the "add" button to add a new site."; 
			localStorage.setItem("c3","");
			document.getElementById("c3").innerHTML = "No Change";
			myApp.swipeoutClose($$('li.swipeout').eq(i));
		});  
		$$('.action4').on('click', function () {
			var siteslist = localStorage.getObj("sites");
			var i = 4;
			siteslist.splice(i,1);
			localStorage.setObj("sites",siteslist)
			document.getElementById("r4").innerHTML = "Empty: Click the "add" button to add a new site."; 
			localStorage.setItem("c4","");
			document.getElementById("c4").innerHTML = "No Change";
			myApp.swipeoutClose($$('li.swipeout').eq(i));
		});  
		$$('.action5').on('click', function () {
			var siteslist = localStorage.getObj("sites");
			var i = 5;
			siteslist.splice(i,1);
			localStorage.setObj("sites",siteslist)
			document.getElementById("r5").innerHTML = "Empty: Click the "add" button to add a new site."; 
			localStorage.setItem("c5","");
			document.getElementById("c5").innerHTML = "No Change";
			myApp.swipeoutClose($$('li.swipeout').eq(i));
		});  
      var ptrContent = $$('.pull-to-refresh-content');
      // Add 'refresh' listener on it
      ptrContent.on('refresh', function (e) {
          // Emulate 2s loading
          setTimeout(function () {
              checkSites()
              myApp.pullToRefreshDone();
          }, 1000);
      });
    </script>
<script src='fastbutton.js'></script>
<script>
      $('#showi').click(function(ev) {
	  myApp.prompt('Please input URL', 'Adding Homework Site', function (k) {
	  if(k==""){
	  	console.log("empty");
	  }
	  else{
	  addSite(k);
	  }
	  });
      }).submit(function() {
        return false;
      });
      $('#shows').click(function(ev) {
        $("#body1").hide();
        $("#body2").show();
        $("#body3").hide();
		$("#body4").hide();
      }).submit(function() {
        return false;
      });
      $('#title').click(function(ev) {
        $("#body1").show();
        $("#body2").hide();
        $("#body3").hide();
		$("#body4").hide();
      }).submit(function() {
        return false;
      });
      $('#showa').click(function(ev) {
        $("#body1").hide();
        $("#body2").hide();
        $("#body3").show();
		$("#body4").hide();
      }).submit(function() {
        return false;
      });
    $('#a0').click(function(ev) {
        $("#body1").hide();
        $("#body2").hide();
        $("#body3").hide();
		document.getElementById("change").innerHTML = localStorage.getItem("c0");
		$("#body4").show();
      }).submit(function() {
        return false;
      });
	  $('#a1').click(function(ev) {
        $("#body1").hide();
        $("#body2").hide();
        $("#body3").hide();
		document.getElementById("change").innerHTML = localStorage.getItem("c1");
		$("#body4").show();
      }).submit(function() {
        return false;
      });
	  $('#a2').click(function(ev) {
        $("#body1").hide();
        $("#body2").hide();
        $("#body3").hide();
		document.getElementById("change").innerHTML = localStorage.getItem("c2");
		$("#body4").show();
      }).submit(function() {
        return false;
      });
	  $('#a3').click(function(ev) {
        $("#body1").hide();
        $("#body2").hide();
        $("#body3").hide();
		document.getElementById("change").innerHTML = localStorage.getItem("c3");
		$("#body4").show();
      }).submit(function() {
        return false;
      });
	  $('#a4').click(function(ev) {
        $("#body1").hide();
        $("#body2").hide();
        $("#body3").hide();
		document.getElementById("change").innerHTML = localStorage.getItem("c4");
		$("#body4").show();
      }).submit(function() {
        return false;
      });
	  $('#a5').click(function(ev) {
        $("#body1").hide();
        $("#body2").hide();
        $("#body3").hide();
		document.getElementById("change").innerHTML = localStorage.getItem("c5");
		$("#body4").show();
      }).submit(function() {
        return false;
      });
</script>
<script>
function clearList(){
	var i = 0;
	while (i<5){
		var t = "r";
		t += i.toString();
		i++;
		document.getElementById(t).innerHTML = "Empty: Click the "add" button to add a new site.";
	}
	}
	</script>
<script>
function clearSites(form){
localStorage.setItem("sites", "");
console.log("Sites List Cleared")
clearList()
}
</script>
<script>
function addSite (form) {
    var newSite = form;
	console.log(newSite);
var siteslist = [""];
try {
siteslist = localStorage.getObj("sites");
	siteslist.push(newSite);
	localStorage.setObj("sites", siteslist);
}
catch(err) {
	siteslist = [];
    console.log("empty user" + err);
	siteslist.push(newSite);
	localStorage.setObj("sites", siteslist);
	
}
console.log(localStorage.getObj("sites"));
checkSites()
}
</script>
</center>
</HTML>
</div>
